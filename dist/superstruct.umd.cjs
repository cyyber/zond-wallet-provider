"use strict";var z=Object.defineProperty;var x=(e,n,r)=>n in e?z(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var d=(e,n,r)=>(x(e,typeof n!="symbol"?n+"":n,r),r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class A extends TypeError{constructor(r,t){let i;const{message:o,explanation:f,...c}=r,{path:a}=r,s=a.length===0?o:`At path: ${a.join(".")} -- ${o}`;super(f??s);d(this,"value");d(this,"key");d(this,"type");d(this,"refinement");d(this,"path");d(this,"branch");d(this,"failures");f!=null&&(this.cause=s),Object.assign(this,c),this.name=this.constructor.name,this.failures=()=>i??(i=[r,...t()])}}function N(e){return b(e)&&typeof e[Symbol.iterator]=="function"}function b(e){return typeof e=="object"&&e!==null}function y(e){return typeof e=="symbol"?e.toString():typeof e=="string"?JSON.stringify(e):`${e}`}function O(e){const{done:n,value:r}=e.next();return n?void 0:r}function I(e,n,r,t){if(e===!0)return;e===!1?e={}:typeof e=="string"&&(e={message:e});const{path:i,branch:o}=n,{type:f}=r,{refinement:c,message:a=`Expected a value of type \`${f}\`${c?` with refinement \`${c}\``:""}, but received: \`${y(t)}\``}=e;return{value:t,type:f,refinement:c,key:i[i.length-1],path:i,branch:o,...e,message:a}}function*g(e,n,r,t){N(e)||(e=[e]);for(const i of e){const o=I(i,n,r,t);o&&(yield o)}}function*w(e,n,r={}){const{path:t=[],branch:i=[e],coerce:o=!1,mask:f=!1}=r,c={path:t,branch:i};if(o&&(e=n.coercer(e,c),f&&n.type!=="type"&&b(n.schema)&&b(e)&&!Array.isArray(e)))for(const s in e)n.schema[s]===void 0&&delete e[s];let a="valid";for(const s of n.validator(e,c))s.explanation=r.message,a="not_valid",yield[s,void 0];for(let[s,u,S]of n.entries(e,c)){const m=w(u,S,{path:s===void 0?t:[...t,s],branch:s===void 0?i:[...i,u],coerce:o,mask:f,message:r.message});for(const h of m)h[0]?(a=h[0].refinement===null||h[0].refinement===void 0?"not_valid":"not_refined",yield[h[0],void 0]):o&&(u=h[1],s===void 0?e=u:e instanceof Map?e.set(s,u):e instanceof Set?e.add(u):b(e)&&(u!==void 0||s in e)&&(e[s]=u))}if(a!=="not_valid")for(const s of n.refiner(e,c))s.explanation=r.message,a="not_refined",yield[s,void 0];a==="valid"&&(yield[void 0,e])}class l{constructor(n){d(this,"TYPE");d(this,"type");d(this,"schema");d(this,"coercer");d(this,"validator");d(this,"refiner");d(this,"entries");const{type:r,schema:t,validator:i,refiner:o,coercer:f=a=>a,entries:c=function*(){}}=n;this.type=r,this.schema=t,this.entries=c,this.coercer=f,i?this.validator=(a,s)=>{const u=i(a,s);return g(u,s,this,a)}:this.validator=()=>[],o?this.refiner=(a,s)=>{const u=o(a,s);return g(u,s,this,a)}:this.refiner=()=>[]}assert(n,r){return E(n,this,r)}create(n,r){return T(n,this,r)}is(n){return k(n,this)}mask(n,r){return V(n,this,r)}validate(n,r={}){return $(n,this,r)}}function E(e,n,r){const t=$(e,n,{message:r});if(t[0])throw t[0]}function T(e,n,r){const t=$(e,n,{coerce:!0,message:r});if(t[0])throw t[0];return t[1]}function V(e,n,r){const t=$(e,n,{coerce:!0,mask:!0,message:r});if(t[0])throw t[0];return t[1]}function k(e,n){return!$(e,n)[0]}function $(e,n,r={}){const t=w(e,n,r),i=O(t);return i[0]?[new A(i[0],function*(){for(const c of t)c[0]&&(yield c[0])}),void 0]:[void 0,i[1]]}function p(e,n){return new l({type:e,schema:null,validator:n})}function _(e){let n;return new l({type:"lazy",schema:null,*entries(r,t){n??(n=e()),yield*n.entries(r,t)},validator(r,t){return n??(n=e()),n.validator(r,t)},coercer(r,t){return n??(n=e()),n.coercer(r,t)},refiner(r,t){return n??(n=e()),n.refiner(r,t)}})}function M(){return p("any",()=>!0)}function F(e){return new l({type:"array",schema:e,*entries(n){if(e&&Array.isArray(n))for(const[r,t]of n.entries())yield[r,t,e]},coercer(n){return Array.isArray(n)?n.slice():n},validator(n){return Array.isArray(n)||`Expected an array value, but received: ${y(n)}`}})}function K(){return p("bigint",e=>typeof e=="bigint")}function P(){return p("boolean",e=>typeof e=="boolean")}function v(e){return p("instance",n=>n instanceof e||`Expected a \`${e.name}\` instance, but received: ${y(n)}`)}function D(){return p("integer",e=>typeof e=="number"&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${y(e)}`)}function J(e){const n=y(e),r=typeof e;return new l({type:"literal",schema:r==="string"||r==="number"||r==="boolean"?e:null,validator(t){return t===e||`Expected the literal \`${n}\`, but received: ${y(t)}`}})}function R(){return p("never",()=>!1)}function Y(e){return new l({...e,validator:(n,r)=>n===null||e.validator(n,r),refiner:(n,r)=>n===null||e.refiner(n,r)})}function q(){return p("number",e=>typeof e=="number"&&!isNaN(e)||`Expected a number, but received: ${y(e)}`)}function B(e){const n=e?Object.keys(e):[],r=R();return new l({type:"object",schema:e??null,*entries(t){if(e&&b(t)){const i=new Set(Object.keys(t));for(const o of n)i.delete(o),yield[o,t[o],e[o]];for(const o of i)yield[o,t[o],r]}},validator(t){return b(t)||`Expected an object, but received: ${y(t)}`},coercer(t){return b(t)?{...t}:t}})}function G(e){return new l({...e,validator:(n,r)=>n===void 0||e.validator(n,r),refiner:(n,r)=>n===void 0||e.refiner(n,r)})}function H(e,n){return new l({type:"record",schema:null,*entries(r){if(b(r))for(const t in r){const i=r[t];yield[t,t,e],yield[t,i,n]}},validator(r){return b(r)||`Expected an object, but received: ${y(r)}`}})}function L(){return p("string",e=>typeof e=="string"||`Expected a string, but received: ${y(e)}`)}function Q(e){const n=e.map(r=>r.type).join(" | ");return new l({type:"union",schema:null,coercer(r){for(const t of e){const[i,o]=t.validate(r,{coerce:!0});if(!i)return o}return r},validator(r,t){const i=[];for(const o of e){const[...f]=w(r,o,t),[c]=f;if(!(c!=null&&c[0]))return[];for(const[a]of f)a&&i.push(a)}return[`Expected the value to satisfy a union of \`${n}\`, but received: ${y(r)}`,...i]}})}function U(){return p("unknown",()=>!0)}function W(e,n,r){return new l({...e,coercer:(t,i)=>k(t,n)?e.coercer(r(t,i),i):e.coercer(t,i)})}function X(e,n){return j(e,"pattern",r=>n.test(r)||`Expected a ${e.type} matching \`/${n.source}/\` but received "${r}"`)}function Z(e,n,r=n){const t=`Expected a ${e.type}`,i=n===r?`of \`${n}\``:`between \`${n}\` and \`${r}\``;return j(e,"size",o=>{if(typeof o=="number"||o instanceof Date)return n<=o&&o<=r||`${t} ${i} but received \`${o}\``;if(o instanceof Map||o instanceof Set){const{size:c}=o;return n<=c&&c<=r||`${t} with a size ${i} but received one with a size of \`${c}\``}const{length:f}=o;return n<=f&&f<=r||`${t} with a length ${i} but received one with a length of \`${f}\``})}function j(e,n,r){return new l({...e,*refiner(t,i){yield*e.refiner(t,i);const o=r(t,i),f=g(o,i,e,t);for(const c of f)yield{...c,refinement:n}}})}exports.Struct=l;exports.any=M;exports.array=F;exports.assert=E;exports.bigint=K;exports.boolean=P;exports.coerce=W;exports.define=p;exports.instance=v;exports.integer=D;exports.is=k;exports.lazy=_;exports.literal=J;exports.nullable=Y;exports.number=q;exports.object=B;exports.optional=G;exports.pattern=X;exports.record=H;exports.refine=j;exports.size=Z;exports.string=L;exports.union=Q;exports.unknown=U;
