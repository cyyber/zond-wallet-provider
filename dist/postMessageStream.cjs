"use strict";var v=Object.defineProperty;var f=s=>{throw TypeError(s)};var E=(s,t,e)=>t in s?v(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>E(s,typeof t!="symbol"?t+"":t,e),w=(s,t,e)=>t.has(s)||f("Cannot "+e);var d=(s,t,e)=>(w(s,t,"read from private field"),e?e.call(s):t.get(s)),c=(s,t,e)=>t.has(s)?f("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),l=(s,t,e,o)=>(w(s,t,"write to private field"),o?o.call(s,e):t.set(s,e),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const D=require("./browser-DjQM3S9H.cjs"),p=require("./versions-B2aqwtzZ.cjs"),u=()=>{},M="SYN",_="ACK";class n extends D.browserExports.Duplex{constructor(e){super({objectMode:!0,...e});r(this,"_init");r(this,"_haveSyn");r(this,"_log");this._init=!1,this._haveSyn=!1,this._log=()=>null}_handshake(){this._write(M,null,u),this.cork()}_onData(e){if(this._init)try{this.push(e),this._log(e,!1)}catch(o){this.emit("error",o)}else e===M?(this._haveSyn=!0,this._write(_,null,u)):e===_&&(this._init=!0,this._haveSyn||this._write(_,null,u),this.uncork())}_read(){}_write(e,o,a){e!==_&&e!==M&&this._log(e,!0),this._postMessage(e),a()}_setLogger(e){this._log=e}}const y="dedicatedWorker";function i(s){return p.isObject(s)&&!!s.data&&(typeof s.data=="number"||typeof s.data=="object"||typeof s.data=="string")}class O extends n{constructor(t={}){if(super(t),typeof globalThis.process.send!="function")throw new Error("Parent IPC channel not found. This class should only be instantiated in a Node.js child process.");this._onMessage=this._onMessage.bind(this),globalThis.process.on("message",this._onMessage),this._handshake()}_postMessage(t){globalThis.process.send({data:t})}_onMessage(t){i(t)&&this._onData(t.data)}_destroy(){globalThis.process.removeListener("message",this._onMessage)}}class T extends n{constructor({process:e,...o}){super(o);r(this,"_process");this._process=e,this._onMessage=this._onMessage.bind(this),this._process.on("message",this._onMessage),this._handshake()}_postMessage(e){this._process.send({data:e})}_onMessage(e){i(e)&&this._onData(e.data)}_destroy(){this._process.removeListener("message",this._onMessage)}}var h,g;class x extends n{constructor({name:e,target:o,...a}){super(a);c(this,h);c(this,g);l(this,h,e),l(this,g,o),this._onMessage=this._onMessage.bind(this),this._getRuntime().onMessage.addListener(this._onMessage),this._handshake()}_postMessage(e){this._getRuntime().sendMessage({target:d(this,g),data:e})}_onMessage(e){!i(e)||e.target!==d(this,h)||this._onData(e.data)}_getRuntime(){var e,o;if("chrome"in globalThis&&typeof((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)=="function")return chrome.runtime;if("browser"in globalThis&&typeof((o=browser==null?void 0:browser.runtime)==null?void 0:o.sendMessage)=="function")return browser.runtime;throw new Error("browser.runtime.sendMessage is not a function. This class should only be instantiated in a web extension.")}_destroy(){this._getRuntime().onMessage.removeListener(this._onMessage)}}h=new WeakMap,g=new WeakMap;class L extends n{constructor({worker:e,...o}){super(o);r(this,"_target");r(this,"_worker");this._target=y,this._worker=e,this._worker.onmessage=this._onMessage.bind(this),this._handshake()}_postMessage(e){this._worker.postMessage({target:this._target,data:e})}_onMessage(e){const o=e.data;i(o)&&this._onData(o.data)}_destroy(){this._worker.onmessage=null,this._worker=null}}class R extends n{constructor(e={}){if(typeof self>"u"||typeof WorkerGlobalScope>"u")throw new Error("WorkerGlobalScope not found. This class should only be instantiated in a WebWorker.");super(e);r(this,"_name");this._name=y,self.addEventListener("message",this._onMessage.bind(this)),this._handshake()}_postMessage(e){self.postMessage({data:e})}_onMessage(e){const o=e.data;!i(o)||o.target!==this._name||this._onData(o.data)}_destroy(){}}var m;const S=(m=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"source"))==null?void 0:m.get;p.assert(S,"MessageEvent.prototype.source getter is not defined.");var b;const k=(b=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"origin"))==null?void 0:b.get;p.assert(k,"MessageEvent.prototype.origin getter is not defined.");class j extends n{constructor({name:e,target:o,targetOrigin:a=location.origin,targetWindow:P=window,...W}){super(W);r(this,"_name");r(this,"_target");r(this,"_targetOrigin");r(this,"_targetWindow");if(typeof window>"u"||typeof window.postMessage!="function")throw new Error("window.postMessage is not a function. This class should only be instantiated in a Window.");this._name=e,this._target=o,this._targetOrigin=a,this._targetWindow=P,this._onMessage=this._onMessage.bind(this),window.addEventListener("message",this._onMessage,!1),this._handshake()}_postMessage(e){this._targetWindow.postMessage({target:this._target,data:e},this._targetOrigin)}_onMessage(e){const o=e.data;this._targetOrigin!=="*"&&k.call(e)!==this._targetOrigin||S.call(e)!==this._targetWindow||!i(o)||o.target!==this._name||this._onData(o.data)}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}exports.BasePostMessageStream=n;exports.BrowserRuntimePostMessageStream=x;exports.ProcessMessageStream=O;exports.ProcessParentMessageStream=T;exports.WebWorkerParentPostMessageStream=L;exports.WebWorkerPostMessageStream=R;exports.WindowPostMessageStream=j;
