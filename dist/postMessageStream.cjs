"use strict";var E=Object.defineProperty;var f=t=>{throw TypeError(t)};var P=(t,s,e)=>s in t?E(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var i=(t,s,e)=>P(t,typeof s!="symbol"?s+"":s,e),p=(t,s,e)=>s.has(t)||f("Cannot "+e);var d=(t,s,e)=>(p(t,s,"read from private field"),e?e.call(t):s.get(t)),u=(t,s,e)=>s.has(t)?f("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,e),c=(t,s,e,r)=>(p(t,s,"write to private field"),r?r.call(t,e):s.set(t,e),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const O=require("./browser-DjQM3S9H.cjs"),w=require("./versions-B2aqwtzZ.cjs"),l=()=>{},M="SYN",h="ACK";class g extends O.browserExports.Duplex{constructor(e){super({objectMode:!0,...e});i(this,"_init");i(this,"_haveSyn");i(this,"_log");this._init=!1,this._haveSyn=!1,this._log=()=>null}_handshake(){this._write(M,null,l),this.cork()}_onData(e){if(this._init)try{this.push(e),this._log(e,!1)}catch(r){this.emit("error",r)}else e===M?(this._haveSyn=!0,this._write(h,null,l)):e===h&&(this._init=!0,this._haveSyn||this._write(h,null,l),this.uncork())}_read(){}_write(e,r,o){e!==h&&e!==M&&this._log(e,!0),this._postMessage(e),o()}_setLogger(e){this._log=e}}const y="dedicatedWorker";function _(t){return w.isObject(t)&&!!t.data&&(typeof t.data=="number"||typeof t.data=="object"||typeof t.data=="string")}var n,a;class D extends g{constructor({name:e,target:r,...o}){super(o);u(this,n);u(this,a);c(this,n,e),c(this,a,r),this._onMessage=this._onMessage.bind(this),this._getRuntime().onMessage.addListener(this._onMessage),this._handshake()}_postMessage(e){this._getRuntime().sendMessage({target:d(this,a),data:e})}_onMessage(e){!_(e)||e.target!==d(this,n)||this._onData(e.data)}_getRuntime(){var e,r;if("chrome"in globalThis&&typeof((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)=="function")return chrome.runtime;if("browser"in globalThis&&typeof((r=browser==null?void 0:browser.runtime)==null?void 0:r.sendMessage)=="function")return browser.runtime;throw new Error("browser.runtime.sendMessage is not a function. This class should only be instantiated in a web extension.")}_destroy(){this._getRuntime().onMessage.removeListener(this._onMessage)}}n=new WeakMap,a=new WeakMap;class x extends g{constructor({worker:e,...r}){super(r);i(this,"_target");i(this,"_worker");this._target=y,this._worker=e,this._worker.onmessage=this._onMessage.bind(this),this._handshake()}_postMessage(e){this._worker.postMessage({target:this._target,data:e})}_onMessage(e){const r=e.data;_(r)&&this._onData(r.data)}_destroy(){this._worker.onmessage=null,this._worker=null}}class R extends g{constructor(e={}){if(typeof self>"u"||typeof WorkerGlobalScope>"u")throw new Error("WorkerGlobalScope not found. This class should only be instantiated in a WebWorker.");super(e);i(this,"_name");this._name=y,self.addEventListener("message",this._onMessage.bind(this)),this._handshake()}_postMessage(e){self.postMessage({data:e})}_onMessage(e){const r=e.data;!_(r)||r.target!==this._name||this._onData(r.data)}_destroy(){}}var m;const S=(m=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"source"))==null?void 0:m.get;w.assert(S,"MessageEvent.prototype.source getter is not defined.");var b;const k=(b=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"origin"))==null?void 0:b.get;w.assert(k,"MessageEvent.prototype.origin getter is not defined.");class T extends g{constructor({name:e,target:r,targetOrigin:o=location.origin,targetWindow:W=window,...v}){super(v);i(this,"_name");i(this,"_target");i(this,"_targetOrigin");i(this,"_targetWindow");if(typeof window>"u"||typeof window.postMessage!="function")throw new Error("window.postMessage is not a function. This class should only be instantiated in a Window.");this._name=e,this._target=r,this._targetOrigin=o,this._targetWindow=W,this._onMessage=this._onMessage.bind(this),window.addEventListener("message",this._onMessage,!1),this._handshake()}_postMessage(e){this._targetWindow.postMessage({target:this._target,data:e},this._targetOrigin)}_onMessage(e){const r=e.data;this._targetOrigin!=="*"&&k.call(e)!==this._targetOrigin||S.call(e)!==this._targetWindow||!_(r)||r.target!==this._name||this._onData(r.data)}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}exports.BasePostMessageStream=g;exports.BrowserRuntimePostMessageStream=D;exports.WebWorkerParentPostMessageStream=x;exports.WebWorkerPostMessageStream=R;exports.WindowPostMessageStream=T;
