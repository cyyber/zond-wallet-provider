"use strict";var E=Object.defineProperty;var M=t=>{throw TypeError(t)};var P=(t,s,e)=>s in t?E(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var n=(t,s,e)=>P(t,typeof s!="symbol"?s+"":s,e),p=(t,s,e)=>s.has(t)||M("Cannot "+e);var h=(t,s,e)=>(p(t,s,"read from private field"),e?e.call(t):s.get(t)),_=(t,s,e)=>s.has(t)?M("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,e),u=(t,s,e,i)=>(p(t,s,"write to private field"),i?i.call(t,e):s.set(t,e),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const W=require("./browser-DjQM3S9H.cjs"),l=require("./versions-B2aqwtzZ.cjs"),d=()=>{},c="SYN",g="ACK";class w extends W.browserExports.Duplex{constructor(e){super({objectMode:!0,...e});n(this,"_init");n(this,"_haveSyn");n(this,"_log");this._init=!1,this._haveSyn=!1,this._log=()=>null}_handshake(){this._write(c,null,d),this.cork()}_onData(e){if(this._init)try{this.push(e),this._log(e,!1)}catch(i){this.emit("error",i)}else e===c?(this._haveSyn=!0,this._write(g,null,d)):e===g&&(this._init=!0,this._haveSyn||this._write(g,null,d),this.uncork())}_read(){}_write(e,i,r){e!==g&&e!==c&&this._log(e,!0),this._postMessage(e),r()}_setLogger(e){this._log=e}}function y(t){return l.isObject(t)&&!!t.data&&(typeof t.data=="number"||typeof t.data=="object"||typeof t.data=="string")}var o,a;class j extends w{constructor({name:e,target:i,...r}){super(r);_(this,o);_(this,a);u(this,o,e),u(this,a,i),this._onMessage=this._onMessage.bind(this),this._getRuntime().onMessage.addListener(this._onMessage),this._handshake()}_postMessage(e){this._getRuntime().sendMessage({target:h(this,a),data:e})}_onMessage(e){!y(e)||e.target!==h(this,o)||this._onData(e.data)}_getRuntime(){var e,i;if("chrome"in globalThis&&typeof((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)=="function")return chrome.runtime;if("browser"in globalThis&&typeof((i=browser==null?void 0:browser.runtime)==null?void 0:i.sendMessage)=="function")return browser.runtime;throw new Error("browser.runtime.sendMessage is not a function. This class should only be instantiated in a web extension.")}_destroy(){this._getRuntime().onMessage.removeListener(this._onMessage)}}o=new WeakMap,a=new WeakMap;var f;const b=(f=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"source"))==null?void 0:f.get;l.assert(b,"MessageEvent.prototype.source getter is not defined.");var m;const S=(m=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"origin"))==null?void 0:m.get;l.assert(S,"MessageEvent.prototype.origin getter is not defined.");class x extends w{constructor({name:e,target:i,targetOrigin:r=location.origin,targetWindow:v=window,...O}){super(O);n(this,"_name");n(this,"_target");n(this,"_targetOrigin");n(this,"_targetWindow");if(typeof window>"u"||typeof window.postMessage!="function")throw new Error("window.postMessage is not a function. This class should only be instantiated in a Window.");this._name=e,this._target=i,this._targetOrigin=r,this._targetWindow=v,this._onMessage=this._onMessage.bind(this),window.addEventListener("message",this._onMessage,!1),this._handshake()}_postMessage(e){this._targetWindow.postMessage({target:this._target,data:e},this._targetOrigin)}_onMessage(e){const i=e.data;this._targetOrigin!=="*"&&S.call(e)!==this._targetOrigin||b.call(e)!==this._targetWindow||!y(i)||i.target!==this._name||this._onData(i.data)}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}exports.BasePostMessageStream=w;exports.BrowserRuntimePostMessageStream=j;exports.WindowPostMessageStream=x;
