"use strict";var N=s=>{throw TypeError(s)};var j=(s,u,r)=>u.has(s)||N("Cannot "+r);var m=(s,u,r)=>(j(s,u,"read from private field"),r?r.call(s):u.get(s)),R=(s,u,r)=>u.has(s)?N("Cannot add the same private member more than once"):u instanceof WeakSet?u.add(s):u.set(s,r),g=(s,u,r,t)=>(j(s,u,"write to private field"),t?t.call(s,r):u.set(s,r),r),a=(s,u,r)=>(j(s,u,"access private method"),r);const h=require("./classes-85kWLKen.cjs"),G=require("./safeEventEmitter.cjs"),J=require("./versions-B2aqwtzZ.cjs"),O=4294967295;let A=Math.floor(Math.random()*O);function z(){return A=(A+1)%O,A}function X(){return(s,u,r,t)=>{const e=s.id,n=z();s.id=n,u.id=n,r(i=>{s.id=e,u.id=e,i()})}}const Y="This engine is destroyed and can no longer be used.";var v,E,l,p,C,$,H,f,T,D,U,M,B;const y=class y extends G{constructor({notificationHandler:r}={}){super();R(this,p);R(this,v,!1);R(this,E);R(this,l);g(this,E,[]),g(this,l,r)}destroy(){m(this,E).forEach(r=>{"destroy"in r&&typeof r.destroy=="function"&&r.destroy()}),g(this,E,[]),g(this,v,!0)}push(r){a(this,p,C).call(this),m(this,E).push(r)}handle(r,t){if(a(this,p,C).call(this),t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(r)?t?a(this,p,$).call(this,r,t):a(this,p,$).call(this,r):t?a(this,p,H).call(this,r,t):this._promiseHandle(r)}asMiddleware(){return a(this,p,C).call(this),async(r,t,e,n)=>{var i,d;try{const[o,c,w]=await a(i=y,f,D).call(i,r,t,m(this,E));return c?(await a(d=y,f,M).call(d,w),n(o)):e(async S=>{var x;try{await a(x=y,f,M).call(x,w)}catch(F){return S(F)}return S()})}catch(o){return n(o)}}}async _promiseHandle(r){return new Promise((t,e)=>{a(this,p,H).call(this,r,(n,i)=>{n&&i===void 0?e(n):t(i)}).catch(e)})}};v=new WeakMap,E=new WeakMap,l=new WeakMap,p=new WeakSet,C=function(){if(m(this,v))throw new Error(Y)},$=async function(r,t){try{if(r.length===0){const n=[{id:null,jsonrpc:"2.0",error:new h.JsonRpcError(h.errorCodes.rpc.invalidRequest,"Request batch must contain plain objects. Received an empty array")}];return t?t(null,n):n}const e=(await Promise.all(r.map(this._promiseHandle.bind(this)))).filter(n=>n!==void 0);return t?t(null,e):e}catch(e){if(t)return t(e);throw e}},H=async function(r,t){var d;if(!r||Array.isArray(r)||typeof r!="object"){const o=new h.JsonRpcError(h.errorCodes.rpc.invalidRequest,`Requests must be plain objects. Received: ${typeof r}`,{request:r});return t(o,{id:null,jsonrpc:"2.0",error:o})}if(typeof r.method!="string"){const o=new h.JsonRpcError(h.errorCodes.rpc.invalidRequest,`Must specify a string method. Received: ${typeof r.method}`,{request:r});return m(this,l)&&!J.isJsonRpcRequest(r)?t(null):t(o,{id:r.id??null,jsonrpc:"2.0",error:o})}if(m(this,l)&&!J.isJsonRpcRequest(r)){try{await m(this,l).call(this,r)}catch(o){return t(o)}return t(null)}let e=null;const n={...r},i={id:n.id,jsonrpc:n.jsonrpc};try{await a(d=y,f,T).call(d,n,i,m(this,E))}catch(o){e=o}return e&&(delete i.result,i.error||(i.error=h.serializeError(e))),t(e,i)},f=new WeakSet,T=async function(r,t,e){var o,c,w;const[n,i,d]=await a(o=y,f,D).call(o,r,t,e);if(a(c=y,f,B).call(c,r,t,i),await a(w=y,f,M).call(w,d),n)throw n},D=async function(r,t,e){var o;const n=[];let i=null,d=!1;for(const c of e)if([i,d]=await a(o=y,f,U).call(o,r,t,c,n),d)break;return[i,d,n.reverse()]},U=async function(r,t,e,n){return new Promise(i=>{const d=c=>{const w=c||t.error;w&&(t.error=h.serializeError(w)),i([w,!0])},o=c=>{t.error?d(t.error):(c&&(typeof c!="function"&&d(new h.JsonRpcError(h.errorCodes.rpc.internal,`JsonRpcEngine: "next" return handlers must be functions. Received "${typeof c}" for request:
${I(r)}`,{request:r})),n.push(c)),i([null,!1]))};try{e(r,t,o,d)}catch(c){d(c)}})},M=async function(r){for(const t of r)await new Promise((e,n)=>{t(i=>i?n(i):e())})},B=function(r,t,e){if(!J.hasProperty(t,"result")&&!J.hasProperty(t,"error"))throw new h.JsonRpcError(h.errorCodes.rpc.internal,`JsonRpcEngine: Response has no error or result for request:
${I(r)}`,{request:r});if(!e)throw new h.JsonRpcError(h.errorCodes.rpc.internal,`JsonRpcEngine: Nothing ended request:
${I(r)}`,{request:r})},R(y,f);let P=y;function I(s){return JSON.stringify(s,null,2)}exports.JsonRpcEngine=P;exports.createIdRemapMiddleware=X;exports.getUniqueId=z;
